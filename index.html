
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jayden's Closet Debug (Fixed)</title>
  <style>
    body { font-family: sans-serif; padding: 1rem; background: #f7f7f7; color: #333; }
    .closet-grid { display: flex; flex-wrap: wrap; gap: 1rem; margin-top: 1rem; }
    .closet-item { background: white; padding: 1rem; border: 1px solid #ccc; border-radius: 6px; width: 120px; text-align: center; }
    .closet-item img { width: 100%; height: auto; }
    #log { margin-top: 2rem; font-size: 0.85rem; white-space: pre-wrap; background: #eee; padding: 1rem; border-radius: 6px; }
  </style>
</head>
<body>

<h2>Closet Debug Interface</h2>

<input type="file" id="fileInput" accept="image/*"><br>
<input type="text" id="labelInput" placeholder="Item name (e.g. Blue Hoodie)"><br>
<select id="categorySelect">
  <option value="top">Top</option>
  <option value="bottom">Bottom</option>
  <option value="shoes">Shoes</option>
  <option value="hat">Hat</option>
  <option value="socks">Socks</option>
  <option value="accessory">Accessory</option>
</select><br>
<input type="text" id="subcategoryInput" placeholder="Subcategory (e.g. Tee)"><br>
<button id="addBtn">Add to Closet</button>

<div class="closet-grid" id="closetGrid"></div>
<div id="log"></div>

<script>
window.onload = function() {
  let closet = [];
  try {
    closet = JSON.parse(localStorage.getItem("closet") || "[]");
    log("Loaded closet from localStorage.");
  } catch (e) {
    log("localStorage error: " + e.message);
  }

  function log(msg) {
    const logDiv = document.getElementById("log");
    logDiv.textContent += msg + "\n";
    console.log(msg);
  }

  function renderCloset() {
    const grid = document.getElementById("closetGrid");
    grid.innerHTML = "";
    closet.forEach(item => {
      const div = document.createElement("div");
      div.className = "closet-item";
      div.innerHTML = \`
        <img src="\${item.src}" alt="\${item.label}">
        <div><strong>\${item.label}</strong></div>
        <small>\${item.category} - \${item.subcategory}</small>
      \`;
      grid.appendChild(div);
    });
  }

  function addItem() {
    log("Add to Closet clicked.");
    const fileInput = document.getElementById("fileInput");
    const label = document.getElementById("labelInput").value.trim();
    const category = document.getElementById("categorySelect").value;
    const subcategory = document.getElementById("subcategoryInput").value.trim();

    if (!fileInput.files[0]) {
      log("No file selected.");
      alert("Please select an image.");
      return;
    }
    if (!label) {
      log("Label missing.");
      alert("Please enter a label.");
      return;
    }

    const reader = new FileReader();
    log("FileReader created.");

    reader.onload = function(e) {
      log("File loaded: " + (e.target.result.length || 0) + " chars.");
      const newItem = {
        src: e.target.result,
        label,
        category,
        subcategory
      };
      closet.push(newItem);
      try {
        localStorage.setItem("closet", JSON.stringify(closet));
        log("Saved to localStorage.");
      } catch (err) {
        log("localStorage save failed: " + err.message);
      }
      renderCloset();
    };

    reader.onerror = function(err) {
      log("Reader error: " + JSON.stringify(err));
      alert("Failed to read image.");
    };

    reader.readAsDataURL(fileInput.files[0]);
    log("Reading image with FileReader...");
  }

  document.getElementById("addBtn").onclick = addItem;

  renderCloset();
};
</script>

</body>
</html>
